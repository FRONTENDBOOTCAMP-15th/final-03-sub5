# 기능 정의서 (수정본)

## 1. 공통 규칙

- 데이터가 없는 경우 "기록 없음" 또는 "데이터가 없습니다" 메시지를 표시한다.
- 필수 입력 항목이 누락된 경우 저장이 불가하며 사용자에게 안내한다.
- 입력값 검증 실패 시 구체적인 오류 메시지를 제공한다.
- 모든 저장/수정/삭제 작업은 사용자 확인 후 진행한다.
- 페이스는 자동 계산되며, 계산 불가 시(거리 또는 시간 0) 입력을 요구한다.
- **로그인한 사용자만 기록을 추가/수정/삭제할 수 있다.**
- **사용자는 본인의 기록만 조회/수정/삭제할 수 있다.**

## 2. 기능 상세

| 기능ID | 기능명 | 우선 순위 | 입력 | 처리 | 출력 | 예외 |
| --- | --- | --- | --- | --- | --- | --- |
| **인증 관련** |
| FD-00 | 로그인 확인 | 1순위 | 페이지 진입 | 로그인 상태 확인 (zustand userStore) | 비로그인 시 로그인 페이지로 리다이렉트 | 로그인 안 됨 |
| **네비게이션** |
| FD-01 | 앵커 스크롤 네비게이션 | 1순위 | 네비게이션 버튼 클릭(홈/기록/분석/최근기록) | 해당 섹션 위치로 부드럽게 스크롤 이동 | 선택한 섹션 화면에 표시 | - |
| **메인 대시보드** |
| FD-02 | 오늘의 러닝 요약 조회 | 1순위 | 오늘 날짜 | 당일 기록 조회 및 총 거리/시간/평균페이스 계산 | 요약 카드 표시 (데이터 없으면 "기록 없음") | 데이터 없음, API 오류 |
| FD-03 | 주간 러닝 거리 조회 | 1순위 | 현재 날짜 기준 1주 | 최근 7일간 거리 합산 | 주간 총 거리(km) 표시 | 데이터 없음, API 오류 |
| FD-04 | 월간 러닝 거리 조회 | 1순위 | 현재 날짜 기준 1개월 | 최근 30일간 거리 합산 | 월간 총 거리(km) 표시 | 데이터 없음, API 오류 |
| FD-05 | 최근 기록 조회 (위젯) | 1순위 | - | 최신 5개 기록 조회 (최신순 정렬) | UI 카드 5개 표시 (없으면 "기록 없음") | 데이터 없음, API 오류 |
| FD-06 | 주간 평균 페이스 통계 | 1순위 | 현재 날짜 기준 1주 | 일별 평균 페이스 계산 후 그래프 데이터 생성 | 꺾은선/막대 그래프 표시 | 데이터 없음, API 오류 |
| **기록 목록** |
| FD-26 | 전체 기록 목록 조회 | 1순위 | 페이지 번호 (기본 1) | 본인의 전체 기록 조회 (최신순, 페이지당 10개) | 기록 목록 표시 (카드 형태), 페이지네이션 | 데이터 없음, API 오류 |
| FD-16 | 기록 필터링 | 2순위 | 기간 선택 (이번 주/월, 지난 주/월, 전체) | 선택된 기간에 해당하는 기록만 조회 | 필터링된 목록 표시 | 결과 없음, API 오류 |
| FD-17 | 기록 정렬 | 2순위 | 정렬 기준 선택 (최신순/거리순/페이스순) | 선택된 기준으로 목록 재정렬 | 정렬된 목록 표시 | - |
| **기록 상세** |
| FD-27 | 기록 상세 조회 | 1순위 | 기록 ID | 해당 기록의 모든 정보 조회 | 상세 정보 표시 (날짜, 시간, 거리, 페이스, 유형, 장소, 칼로리, 메모) | 기록 없음, 권한 없음, API 오류 |
| FD-28 | 기록 소유자 확인 | 1순위 | 기록 ID, 현재 사용자 ID | 기록의 userId와 현재 사용자 비교 | 본인 기록이 아니면 수정/삭제 버튼 숨김 | 권한 없음 |
| **기록 추가** |
| FD-07 | 러닝 기록 추가 - 페이지 진입 | 1순위 | 추가 버튼 클릭 | 로그인 확인 → 빈 입력 폼 표시 | 뒤로가기/저장 버튼, 입력 필드 표시 | 로그인 안 됨 (리다이렉트) |
| FD-08 | 러닝 기록 추가 - 데이터 입력 | 1순위 | 날짜, 운동시간(시:분:초), 거리, 운동유형 (필수), 운동장소, 소모칼로리, 메모 (선택) | 입력값 실시간 검증 (날짜: 미래 불가, 거리: 0.1~200km, 시간: 1분~24시간) | 유효성 피드백 표시 | 검증 실패 시 오류 메시지 |
| FD-09 | 평균 페이스 자동 계산 | 1순위 | 거리(km), 운동시간(시:분:초 객체) | 시간을 초 단위로 변환 → (총 초 ÷ 거리) → "분:초/km" 형식 변환 | 페이스 필드에 자동 표시 (예: "6:15/km") | 거리 또는 시간 0일 때 계산 불가 안내 |
| FD-10 | 러닝 기록 저장 | 1순위 | 저장 버튼 클릭 | 필수 항목 확인 → accessToken과 함께 API 요청 → DB 저장 | 저장 완료 메시지, 기록 목록 페이지로 이동 | 필수 항목 누락, 네트워크 오류, 서버 오류, 토큰 만료 |
| **기록 수정/삭제** |
| FD-11 | 러닝 기록 수정 | 2순위 | 상세 페이지에서 수정 버튼 클릭 | 본인 기록 확인 → 기존 데이터 불러오기 → 수정 폼 표시 | 수정된 데이터 저장 후 상세 페이지로 이동 | 권한 없음, 네트워크 오류, 서버 오류 |
| FD-12 | 러닝 기록 삭제 | 2순위 | 상세 페이지에서 삭제 버튼 클릭 | 본인 기록 확인 → 삭제 확인 모달 → 확인 시 DB 삭제 | 삭제 완료, 목록으로 이동 | 권한 없음, 취소 시 모달 닫기, 네트워크 오류, 서버 오류 |
| **선택 기능** |
| FD-13 | 운동 장소 선택 - 지도 | 2순위 | 지도 API 버튼 클릭 | 위치 권한 요청 → 지도 표시 → 핀 선택 | 선택한 위치 좌표 및 주소 저장 | 위치 권한 거부 시 직접 입력 안내 |
| FD-14 | 운동 장소 선택 - 직접 입력 | 2순위 | 텍스트 입력 | 입력값 저장 | 입력한 텍스트 저장 | - |
| FD-15 | 소모 칼로리 자동 계산 | 2순위 | 거리, 시간, 사용자 체중 (옵션) | 칼로리 = 거리(km) × 체중(kg) × 1.036 (기본 체중 70kg 가정) | 칼로리 필드에 자동 입력 | 수동 수정 가능 |
| **UI/UX** |
| FD-18 | 데이터 로딩 상태 표시 | 1순위 | 페이지 진입 또는 데이터 요청 | 로딩 중 스켈레톤 UI 또는 스피너 표시 | 데이터 로드 완료 후 실제 데이터 표시 | 로딩 실패 시 재시도 버튼, 타임아웃 시 오류 메시지 |
| FD-19 | 새로고침 (Pull to Refresh) | 2순위 | 화면 하단으로 스크롤 또는 새로고침 버튼 | 최신 데이터 재조회 | 갱신된 목록 표시 | API 오류 시 이전 데이터 유지 |
| FD-23 | 최근 기록 자동 관리 | 1순위 | 새 기록 추가 시 | 기록 개수가 5개 초과 시 가장 오래된 기록을 표시 목록에서 제거 (DB는 유지) | 최신 5개 기록만 표시 | - |
| **통계 및 분석** |
| FD-24 | 총 누적 통계 조회 | 2순위 | - | 전체 기간 총 거리, 총 시간, 총 기록 수 계산 | 누적 통계 카드 표시 | 데이터 없음, API 오류 |
| FD-25 | 최고 기록 조회 | 2순위 | - | 최장 거리, 최고 페이스(가장 빠른) 기록 조회 | 최고 기록 배지 표시 | 데이터 없음, API 오류 |
| **고급 기능 (3순위)** |
| FD-20 | 목표 설정 | 3순위 | 주간/월간 목표 거리 입력 | 목표 저장 → 현재 진행률 계산 | 목표 대비 진행률(%) 표시 | - |
| FD-21 | 데이터 내보내기 | 3순위 | 내보내기 버튼 클릭, 형식 선택(CSV/JSON) | 모든 기록 데이터를 선택한 형식으로 변환 | 파일 다운로드 | 데이터 없을 시 안내 |
| FD-22 | 데이터 가져오기 | 3순위 | 파일 업로드 (CSV/JSON) | 파일 파싱 → 유효성 검증 → DB 저장 | 가져온 기록 수 안내, 목록 갱신 | 형식 오류 시 안내 |

## 3. 데이터 구조 (코드 기준)

### 러닝 기록 (RunningRecord)
```typescript
{
  _id: number;                    // 고유 ID (서버 생성)
  userId: number;                 // 사용자 ID (서버 생성)
  date: string;                   // 운동 날짜 (YYYY-MM-DD)
  distance: number;               // 거리 (km, 소수점)
  timeRecord: {                   // 운동 시간 (객체)
    hour: number;
    min: number;
    sec: number;
  };
  recordType: "running" | "walking" | "jogging" | "trekking" | "treadmill";  // 운동 유형
  calorie?: number;               // 소모 칼로리 (kcal, 선택)
  place?: string;                 // 운동 장소 (선택)
  memo?: string;                  // 메모 (선택)
  createdAt: string;              // 생성 일시 (서버 생성)
  updatedAt: string;              // 수정 일시 (서버 생성)
}
```

### 기록 생성 폼 (RecordCreateForm)
```typescript
{
  date: string;
  distance: number;
  timeRecord: { hour: number; min: number; sec: number; };
  recordType: "running" | "walking" | "jogging" | "trekking" | "treadmill";
  calorie?: number;
  place?: string;
  memo?: string;
}
// 주의: _id, userId, createdAt, updatedAt는 서버가 자동 생성
```

### 기록 수정 폼 (RecordUpdateForm)
```typescript
// RecordCreateForm과 동일
```

## 4. 화면 흐름

### 1) 메인 화면 (기록 관리 대시보드) - `/records`
- 앵커 네비게이션 (홈/기록/분석/최근기록)
- 오늘의 러닝 요약
- 주간/월간 러닝 거리
- 평균 페이스 통계 그래프
- 최근 5개 기록 카드 (위젯)
- 기록 추가 버튼 (+)

### 2) 전체 기록 목록 화면 - `/records` (또는 스크롤)
- 필터 (기간별)
- 정렬 (최신순/거리순/페이스순)
- 기록 카드 목록 (페이지네이션 or 무한 스크롤)
- 각 카드 클릭 시 상세 페이지로 이동

### 3) 기록 상세 화면 - `/records/[id]`
- 뒤로가기 버튼
- 모든 기록 정보 표시
  - 날짜, 시간, 거리, 페이스
  - 운동 유형, 장소, 칼로리, 메모
- 수정 버튼 (본인 기록일 때만)
- 삭제 버튼 (본인 기록일 때만)

### 4) 기록 추가 화면 - `/records/new`
- 상단: 뒤로가기 | "러닝 기록 추가" | 저장
- 필수 입력: 날짜, 시간(시:분:초), 거리, 운동유형
- 선택 입력: 장소, 칼로리, 메모
- 자동 계산: 페이스 (실시간 표시)
- 저장 버튼 → 목록으로 이동

### 5) 기록 수정 화면 - `/records/[id]/edit`
- 기존 데이터가 채워진 폼
- 수정 후 저장 → 상세 페이지로 이동

## 5. 예외 및 에러 처리 (상세)

| 상황 | 처리 방식 | 사용자 메시지 |
| --- | --- | --- |
| **데이터 없음** | "기록이 없습니다" 문구 및 기록 추가 버튼 안내 | "아직 기록이 없습니다. 첫 러닝을 기록해보세요!" |
| **로그인 안 됨** | 로그인 페이지로 리다이렉트 (redirect 파라미터 포함) | "로그인이 필요합니다" |
| **권한 없음** (타인 기록 수정/삭제 시도) | 에러 페이지 표시 또는 목록으로 리다이렉트 | "접근 권한이 없습니다" |
| **네트워크 오류** | 재시도 버튼 제공 및 오프라인 모드 안내 | "네트워크 연결을 확인해주세요" + [재시도] 버튼 |
| **서버 오류 (500)** | 에러 메시지 표시 및 재시도 옵션 | "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요" |
| **토큰 만료 (401)** | 로그인 페이지로 리다이렉트 | "세션이 만료되었습니다. 다시 로그인해주세요" |
| **필수 항목 누락** | 해당 필드 하이라이트 및 오류 메시지 표시 | "날짜를 입력해주세요" |
| **유효하지 않은 입력** | 실시간 검증 피드백 | "거리는 0.1~200km 범위입니다" |
| **미래 날짜 입력** | 날짜 필드 오류 표시 | "미래 날짜는 선택할 수 없습니다" |
| **거리 범위 초과** | 입력 필드 오류 표시 | "거리는 0.1~200km 사이로 입력해주세요" |
| **시간 범위 초과** | 입력 필드 오류 표시 | "운동 시간은 1분~24시간 사이로 입력해주세요" |
| **페이스 계산 불가** | 페이스 필드에 안내 표시 | "거리와 시간을 올바르게 입력해주세요" |
| **위치 권한 거부** | 지도 사용 불가 안내 및 직접 입력 유도 | "위치 권한이 필요합니다. 직접 입력을 이용해주세요" |
| **삭제 확인** | 확인 모달 표시 | "정말 삭제하시겠습니까? 삭제된 기록은 복구할 수 없습니다" |
| **데이터 로딩 타임아웃** | 재시도 버튼 및 오류 메시지 | "데이터를 불러오는데 실패했습니다" + [재시도] |
| **중복 저장 방지** | 저장 버튼 비활성화 (isPending) | 로딩 중... |
| **기록 없음 (상세 페이지)** | 404 페이지 또는 목록으로 리다이렉트 | "존재하지 않는 기록입니다" |

## 6. API 연동 규칙

### 요청 헤더
```typescript
{
  "Content-Type": "application/json",
  "Client-Id": CLIENT_ID,
  "Authorization": `Bearer ${accessToken}`  // 인증 필요한 경우
}
```

### 에러 응답 형식
```typescript
{
  ok: 0,
  message: string,
  errors?: {
    [fieldName: string]: {
      msg: string;
    }
  }
}
```

### 성공 응답 형식
```typescript
// 목록 조회
{
  ok: 1,
  item: RunningRecord[]
}

// 상세 조회/생성/수정
{
  ok: 1,
  item: RunningRecord
}

// 삭제
{
  ok: 1
}
```

## 7. 개발 우선순위 (실제 구현 순서)

1. **1단계 (필수 - 1주차)**
   - FD-00: 로그인 확인
   - FD-07~10: 기록 추가 (CRUD의 C)
   - FD-26: 전체 기록 목록 (CRUD의 R)
   - FD-27: 기록 상세 (CRUD의 R)

2. **2단계 (핵심 - 2주차)**
   - FD-11~12: 기록 수정/삭제 (CRUD의 U, D)
   - FD-02~05: 대시보드 통계 (오늘의 요약, 주간/월간 거리, 최근 5개)
   - FD-18: 로딩 상태

3. **3단계 (추가 - 3주차)**
   - FD-06: 평균 페이스 통계 그래프
   - FD-16~17: 필터링/정렬
   - FD-01: 앵커 네비게이션
   - FD-24~25: 누적 통계, 최고 기록

4. **4단계 (선택 - 시간 남으면)**
   - FD-13~15: 장소 선택, 칼로리 계산
   - FD-20~22: 목표 설정, 데이터 내보내기/가져오기
